ğŸ¥ YouTubeå‹•ç”»ã«è‡ªå‹•ã§å­—å¹•ã‚’ã¤ã‘ã‚‹ãƒ„ãƒ¼ãƒ«ï¼ˆWhisper + ffmpeg + yt-dlpï¼‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯YouTubeå‹•ç”»ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€ãã®å‹•ç”»ã‹ã‚‰éŸ³å£°ã‚’åˆ†é›¢ã—ã€Whisperã‚’ä½¿ã£ã¦æ–‡å­—èµ·ã“ã—ã‚’è¡Œã„ã€æœ€çµ‚çš„ã«å‹•ç”»ã«ãƒãƒ¼ãƒ‰ã‚µãƒ–ã‚¿ã‚¤ãƒˆã‚’åŸ‹ã‚è¾¼ã‚€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã™ã€‚

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆä¾‹
```
â”œâ”€â”€ data/                   # å…ƒã®å‹•ç”»ãƒ»éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ output/                 # å‡ºåŠ›ã•ã‚ŒãŸå­—å¹•ãƒ»æœ€çµ‚å‹•ç”»
â”‚   â”œâ”€â”€ sample.ass          # assãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
â”‚   â”œâ”€â”€ sample.mp4          # mp4ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
â”‚   â””â”€â”€ sample.srt          # srtãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ whisper_transcription.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ README.md
â””â”€â”€ README_ja.md(ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«)
```
å‹•ç”»ãƒ»å­—å¹•å‡¦ç†ã®ã‚µãƒ³ãƒ—ãƒ«å‡ºåŠ›
output/sample.mp4 

å®Ÿè¡Œã®ã‚¹ãƒ†ãƒƒãƒ—

1. YouTube å‹•ç”»ã‚’ mp4 ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```
yt-dlp -f bestvideo+bestaudio --merge-output-format mp4 https://ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹URL -o data/input.mp4
```
2. mp4 ã‹ã‚‰ wav ã¸å¤‰æ›ï¼ˆWhisperç”¨ï¼‰
```
ffmpeg -i data/input.mp4 -vn -acodec pcm_s16le -ar 16000 -ac 1 data/input.wav
```
* -vn: æ˜ åƒã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ç„¡è¦–ã—ã¾ã™ï¼ˆéŸ³å£°ã®ã¿ã‚’æŠ½å‡ºï¼‰ã€‚

* -acodec pcm_s16le: ãƒªãƒ‹ã‚¢PCMï¼ˆ16ãƒ“ãƒƒãƒˆãƒ»ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ï¼‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã€‚

* -ar 16000: ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆã‚’16kHzã«è¨­å®šã€‚

* -ac 1: ãƒ¢ãƒãƒ©ãƒ«éŸ³å£°ã«å¤‰æ›ã€‚

3. Whisper ã§æ–‡å­—èµ·ã“ã—

scripts/whisper_transcription.py ã¯ã€ã‚¹ãƒ†ãƒƒãƒ—2ã§å¤‰æ›ã•ã‚ŒãŸ .wav ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦æ—¥æœ¬èªã®æ–‡å­—èµ·ã“ã—ã‚’å®Ÿè¡Œã—ã€.srt å­—å¹•ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚

å®Ÿè¡Œæ–¹æ³•ï¼š
```
python scripts/whisper_transcription.py --input data/input.wav --output_dir ./output --model_size medium --language ja
```
ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€output/input.srt ã«å­—å¹•ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

4. å­—å¹•ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.srtï¼‰ã‚’å‹•ç”»ã«åŸ‹ã‚è¾¼ã‚€
```
ffmpeg -i data/input.mp4 -vf subtitles=output/input.srt output/final_with_subs.mp4
```
5. ç¸¦å‹å‹•ç”»ã§å­—å¹•ãŒåˆ‡ã‚Œã‚‹å ´åˆ

ç¸¦é•·ã®å‹•ç”»ã§ã¯ã€.srt ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã‚‹å­—å¹•ãŒç”»é¢ã«åã¾ã‚Šãã‚‰ãšã€åˆ‡ã‚Œã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®å ´åˆã€.srt ã‚’ .ass ã«å¤‰æ›ã—ã€ç”»é¢ã‚µã‚¤ã‚ºã«åˆã£ãŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’èª¿æ•´ã™ã‚‹ã“ã¨ã§æ”¹å–„ã§ãã¾ã™ã€‚
```
ffmpeg -i output/input.srt output/input.ass
ffprobe -v error -select_streams v:0 -show_entries stream=width,height -of csv=p=0 data/input.mp4
```
ä¸Šè¨˜ ffprobe ã®å‡ºåŠ›ï¼ˆä¾‹ï¼š202,360ï¼‰ã‚’ç¢ºèªã—ã€output/input.ass ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã§é–‹ã„ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ï¼š
```
PlayResX: 202
PlayResY: 360
```
ã“ã‚Œã«ã‚ˆã‚Šã€å­—å¹•ã®ã‚µã‚¤ã‚ºã¨ä½ç½®ãŒç¸¦å‹å‹•ç”»ã«é©ã—ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

6. .ass å­—å¹•ã‚’åŸ‹ã‚è¾¼ã‚“ã æœ€çµ‚å‹•ç”»å‡ºåŠ›
```
ffmpeg -i data/input.mp4 -vf "ass=output/input.ass" -c:a copy output/final_with_subs.mp4
```
ğŸ“¦ ä¾å­˜é–¢ä¿‚

- Python 3.8+
- `ffmpeg`
- `yt-dlp`
- `openai-whisper`

Python ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
```
pip install git+https://github.com/openai/whisper.git

sudo snap install yt-dlp

pip install ffmpeg-python
```
ğŸ“ ãƒ¡ãƒ¢

* éŸ³å£°ã®å“è³ªãŒæ–‡å­—èµ·ã“ã—ã®ç²¾åº¦ã«å½±éŸ¿ã—ã¾ã™ã€‚

* Whisperã¯GPUã‚’ä½¿ã†ã¨é«˜é€Ÿã§ã™ã€‚

* .asså½¢å¼ã®å­—å¹•ã¯ã€ã‚¹ã‚¿ã‚¤ãƒ«ã‚„ç”»é¢ã‚µã‚¤ã‚ºã¸ã®æŸ”è»Ÿãªå¯¾å¿œãŒå¯èƒ½ã§ã™ã€‚

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ MIT ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ã‚‚ã¨ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

æ„è¦‹ã‚„è³ªå•ãŒã‚ã‚Œã°æ­“è¿ã—ã¾ã™ï¼